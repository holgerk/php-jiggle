#!/usr/bin/env php
<?php

// extract examples from test and update readme

$readme = __DIR__ . '/README.md';
$test = __DIR__ . '/test/JiggleTest.php';

$testContent = file_get_contents($test);
preg_match_all(
    "#" .
    "// \<example: (?<title>[^\n]+)" .
    "(?<code>.*?)" .
    "// example>" .
    "#sim", $testContent, $matches);
$titles = $matches['title'];
$codes = $matches['code'];

$content = '';
foreach ($titles as $i => $title) {
    $code = $codes[$i];
    $code =
        implode("\n", array_map(function ($line) { return substr($line, 8); }, explode("\n", $code)));
    $content .= "### $title\n";
    $content .= "```php";
    $content .= "$code";
    $content .= "```\n\n";

}
$readmeContent = file_get_contents($readme);
$readmeContent =preg_replace(
    "#\<!-- START AUTOGENERATED EXAMPLES --\>.+?\<!-- END AUTOGENERATED EXAMPLES --\>#sim",
    "<!-- START AUTOGENERATED EXAMPLES -->\n$content\n<!-- END AUTOGENERATED EXAMPLES -->",
    $readmeContent);

file_put_contents($readme, $readmeContent);

